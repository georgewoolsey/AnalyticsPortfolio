<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 Web Scraping and Functions | Analytics Portfolio</title>
  <meta name="description" content="Using the bookdown package to write a book of analytics projects. The output format for this example is bookdown::gitbook." />
  <meta name="generator" content="bookdown 0.25 and GitBook 2.6.7" />

  <meta property="og:title" content="4 Web Scraping and Functions | Analytics Portfolio" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Using the bookdown package to write a book of analytics projects. The output format for this example is bookdown::gitbook." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Web Scraping and Functions | Analytics Portfolio" />
  
  <meta name="twitter:description" content="Using the bookdown package to write a book of analytics projects. The output format for this example is bookdown::gitbook." />
  

<meta name="author" content="George Woolsey" />


<meta name="date" content="2022-03-20" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="wildfire-recovery.html"/>
<link rel="next" href="sp1.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<link href="libs/dygraphs-1.1.1/dygraph.css" rel="stylesheet" />
<script src="libs/dygraphs-1.1.1/dygraph-combined.js"></script>
<script src="libs/dygraphs-1.1.1/shapes.js"></script>
<script src="libs/moment-2.8.4/moment.js"></script>
<script src="libs/moment-timezone-0.2.5/moment-timezone-with-data.js"></script>
<script src="libs/moment-fquarter-1.0.0/moment-fquarter.min.js"></script>
<script src="libs/dygraphs-binding-1.1.1.6/dygraphs.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.1.0/leaflet.js"></script>
<script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.1.0/leaflet-providers-plugin.js"></script>
<link href="libs/HomeButton-0.0.1/home-button.css" rel="stylesheet" />
<script src="libs/HomeButton-0.0.1/home-button.js"></script>
<script src="libs/HomeButton-0.0.1/easy-button-src.min.js"></script>
<script src="libs/clipboard-0.0.1/setClipboardText.js"></script>
<link href="libs/mapviewCSS-0.0.1/mapview-popup.css" rel="stylesheet" />
<link href="libs/mapviewCSS-0.0.1/mapview.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction<span></span></a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#this-book"><i class="fa fa-check"></i><b>1.1</b> This book<span></span></a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Using R Markdown<span></span></a>
<ul>
<li class="chapter" data-level="2.1" data-path="intro.html"><a href="intro.html#methods"><i class="fa fa-check"></i><b>2.1</b> Methods<span></span></a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="intro.html"><a href="intro.html#site-description"><i class="fa fa-check"></i><b>2.1.1</b> Site Description<span></span></a></li>
<li class="chapter" data-level="2.1.2" data-path="intro.html"><a href="intro.html#data-download"><i class="fa fa-check"></i><b>2.1.2</b> Data Download<span></span></a></li>
<li class="chapter" data-level="2.1.3" data-path="intro.html"><a href="intro.html#static-data-plotter"><i class="fa fa-check"></i><b>2.1.3</b> Static Data Plotter<span></span></a></li>
<li class="chapter" data-level="2.1.4" data-path="intro.html"><a href="intro.html#interactive-data-plotter"><i class="fa fa-check"></i><b>2.1.4</b> Interactive Data Plotter<span></span></a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="intro.html"><a href="intro.html#assignment"><i class="fa fa-check"></i><b>2.2</b> Assignment<span></span></a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="intro.html"><a href="intro.html#dygraph-example"><i class="fa fa-check"></i><b>2.2.1</b> DyGraph example<span></span></a></li>
<li class="chapter" data-level="2.2.2" data-path="intro.html"><a href="intro.html#poudre-river-overview"><i class="fa fa-check"></i><b>2.2.2</b> Poudre River Overview<span></span></a></li>
<li class="chapter" data-level="2.2.3" data-path="intro.html"><a href="intro.html#link-to-presentation-style-webpage"><i class="fa fa-check"></i><b>2.2.3</b> Link to presentation-style webpage<span></span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="wildfire-recovery.html"><a href="wildfire-recovery.html"><i class="fa fa-check"></i><b>3</b> Wildfire Recovery<span></span></a>
<ul>
<li class="chapter" data-level="3.1" data-path="wildfire-recovery.html"><a href="wildfire-recovery.html#read-data"><i class="fa fa-check"></i><b>3.1</b> Read Data<span></span></a></li>
<li class="chapter" data-level="3.2" data-path="wildfire-recovery.html"><a href="wildfire-recovery.html#assignment-1"><i class="fa fa-check"></i><b>3.2</b> Assignment<span></span></a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="wildfire-recovery.html"><a href="wildfire-recovery.html#question-1"><i class="fa fa-check"></i><b>3.2.1</b> Question 1)<span></span></a></li>
<li class="chapter" data-level="3.2.2" data-path="wildfire-recovery.html"><a href="wildfire-recovery.html#question-2"><i class="fa fa-check"></i><b>3.2.2</b> Question 2)<span></span></a></li>
<li class="chapter" data-level="3.2.3" data-path="wildfire-recovery.html"><a href="wildfire-recovery.html#question-3"><i class="fa fa-check"></i><b>3.2.3</b> Question 3)<span></span></a></li>
<li class="chapter" data-level="3.2.4" data-path="wildfire-recovery.html"><a href="wildfire-recovery.html#question-4"><i class="fa fa-check"></i><b>3.2.4</b> Question 4)<span></span></a></li>
<li class="chapter" data-level="3.2.5" data-path="wildfire-recovery.html"><a href="wildfire-recovery.html#question-5"><i class="fa fa-check"></i><b>3.2.5</b> Question 5)<span></span></a></li>
<li class="chapter" data-level="3.2.6" data-path="wildfire-recovery.html"><a href="wildfire-recovery.html#bonus-question-1"><i class="fa fa-check"></i><b>3.2.6</b> Bonus Question 1)<span></span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="web-scraping-and-functions.html"><a href="web-scraping-and-functions.html"><i class="fa fa-check"></i><b>4</b> Web Scraping and Functions<span></span></a>
<ul>
<li class="chapter" data-level="4.1" data-path="web-scraping-and-functions.html"><a href="web-scraping-and-functions.html#simple-web-scraping"><i class="fa fa-check"></i><b>4.1</b> Simple web scraping<span></span></a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="web-scraping-and-functions.html"><a href="web-scraping-and-functions.html#reading-an-html"><i class="fa fa-check"></i><b>4.1.1</b> Reading an html<span></span></a></li>
<li class="chapter" data-level="4.1.2" data-path="web-scraping-and-functions.html"><a href="web-scraping-and-functions.html#data-download-1"><i class="fa fa-check"></i><b>4.1.2</b> Data Download<span></span></a></li>
<li class="chapter" data-level="4.1.3" data-path="web-scraping-and-functions.html"><a href="web-scraping-and-functions.html#data-read-in"><i class="fa fa-check"></i><b>4.1.3</b> Data read-in<span></span></a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="web-scraping-and-functions.html"><a href="web-scraping-and-functions.html#assignment-2"><i class="fa fa-check"></i><b>4.2</b> Assignment:<span></span></a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="web-scraping-and-functions.html"><a href="web-scraping-and-functions.html#question-1-1"><i class="fa fa-check"></i><b>4.2.1</b> Question 1<span></span></a></li>
<li class="chapter" data-level="4.2.2" data-path="web-scraping-and-functions.html"><a href="web-scraping-and-functions.html#question-2-1"><i class="fa fa-check"></i><b>4.2.2</b> Question 2<span></span></a></li>
<li class="chapter" data-level="4.2.3" data-path="web-scraping-and-functions.html"><a href="web-scraping-and-functions.html#question-3-1"><i class="fa fa-check"></i><b>4.2.3</b> Question 3<span></span></a></li>
<li class="chapter" data-level="4.2.4" data-path="web-scraping-and-functions.html"><a href="web-scraping-and-functions.html#question-4-1"><i class="fa fa-check"></i><b>4.2.4</b> Question 4<span></span></a></li>
<li class="chapter" data-level="4.2.5" data-path="web-scraping-and-functions.html"><a href="web-scraping-and-functions.html#question-5-1"><i class="fa fa-check"></i><b>4.2.5</b> Question 5<span></span></a></li>
<li class="chapter" data-level="4.2.6" data-path="web-scraping-and-functions.html"><a href="web-scraping-and-functions.html#question-6"><i class="fa fa-check"></i><b>4.2.6</b> Question 6<span></span></a></li>
<li class="chapter" data-level="4.2.7" data-path="web-scraping-and-functions.html"><a href="web-scraping-and-functions.html#bonus-question-1-1"><i class="fa fa-check"></i><b>4.2.7</b> Bonus Question 1<span></span></a></li>
<li class="chapter" data-level="4.2.8" data-path="web-scraping-and-functions.html"><a href="web-scraping-and-functions.html#bonus-question-2"><i class="fa fa-check"></i><b>4.2.8</b> Bonus Question 2<span></span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="sp1.html"><a href="sp1.html"><i class="fa fa-check"></i><b>5</b> Spatial Analysis (part 1)<span></span></a>
<ul>
<li class="chapter" data-level="5.1" data-path="sp1.html"><a href="sp1.html#lagos-analysis"><i class="fa fa-check"></i><b>5.1</b> LAGOS Analysis<span></span></a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="sp1.html"><a href="sp1.html#loading-in-data"><i class="fa fa-check"></i><b>5.1.1</b> Loading in data<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="sp1.html"><a href="sp1.html#assignment-3"><i class="fa fa-check"></i><b>5.2</b> Assignment<span></span></a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="sp1.html"><a href="sp1.html#question-1-2"><i class="fa fa-check"></i><b>5.2.1</b> Question 1)<span></span></a></li>
<li class="chapter" data-level="5.2.2" data-path="sp1.html"><a href="sp1.html#question-2-2"><i class="fa fa-check"></i><b>5.2.2</b> Question 2)<span></span></a></li>
<li class="chapter" data-level="5.2.3" data-path="sp1.html"><a href="sp1.html#question-3-2"><i class="fa fa-check"></i><b>5.2.3</b> Question 3)<span></span></a></li>
<li class="chapter" data-level="5.2.4" data-path="sp1.html"><a href="sp1.html#question-4-2"><i class="fa fa-check"></i><b>5.2.4</b> Question 4)<span></span></a></li>
<li class="chapter" data-level="5.2.5" data-path="sp1.html"><a href="sp1.html#question-5-2"><i class="fa fa-check"></i><b>5.2.5</b> Question 5)<span></span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="sp2.html"><a href="sp2.html"><i class="fa fa-check"></i><b>6</b> Spatial Analysis (part 2)<span></span></a>
<ul>
<li class="chapter" data-level="6.1" data-path="sp2.html"><a href="sp2.html#lagos-analysis-1"><i class="fa fa-check"></i><b>6.1</b> LAGOS Analysis<span></span></a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="sp2.html"><a href="sp2.html#loading-in-data-1"><i class="fa fa-check"></i><b>6.1.1</b> Loading in data<span></span></a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="sp2.html"><a href="sp2.html#assignment-4"><i class="fa fa-check"></i><b>6.2</b> Assignment<span></span></a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="sp2.html"><a href="sp2.html#question-1-3"><i class="fa fa-check"></i><b>6.2.1</b> Question 1)<span></span></a></li>
<li class="chapter" data-level="6.2.2" data-path="sp2.html"><a href="sp2.html#question-2-3"><i class="fa fa-check"></i><b>6.2.2</b> Question 2)<span></span></a></li>
<li class="chapter" data-level="6.2.3" data-path="sp2.html"><a href="sp2.html#question-3-3"><i class="fa fa-check"></i><b>6.2.3</b> Question 3)<span></span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="regression-analysis.html"><a href="regression-analysis.html"><i class="fa fa-check"></i><b>7</b> Regression Analysis<span></span></a>
<ul>
<li class="chapter" data-level="7.0.1" data-path="regression-analysis.html"><a href="regression-analysis.html#weather-data-analysis"><i class="fa fa-check"></i><b>7.0.1</b> Weather Data Analysis<span></span></a></li>
<li class="chapter" data-level="7.0.2" data-path="regression-analysis.html"><a href="regression-analysis.html#temperature-trends"><i class="fa fa-check"></i><b>7.0.2</b> Temperature trends<span></span></a></li>
<li class="chapter" data-level="7.0.3" data-path="regression-analysis.html"><a href="regression-analysis.html#assignment-5"><i class="fa fa-check"></i><b>7.0.3</b> Assignment<span></span></a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="beginning-machine-learning.html"><a href="beginning-machine-learning.html"><i class="fa fa-check"></i><b>8</b> Beginning Machine Learning<span></span></a>
<ul>
<li class="chapter" data-level="8.1" data-path="beginning-machine-learning.html"><a href="beginning-machine-learning.html#objective"><i class="fa fa-check"></i><b>8.1</b> Objective<span></span></a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="beginning-machine-learning.html"><a href="beginning-machine-learning.html#data-read"><i class="fa fa-check"></i><b>8.1.1</b> Data read<span></span></a></li>
<li class="chapter" data-level="8.1.2" data-path="beginning-machine-learning.html"><a href="beginning-machine-learning.html#spatial-autocorrelation-grouping"><i class="fa fa-check"></i><b>8.1.2</b> Spatial autocorrelation grouping<span></span></a></li>
<li class="chapter" data-level="8.1.3" data-path="beginning-machine-learning.html"><a href="beginning-machine-learning.html#model-development"><i class="fa fa-check"></i><b>8.1.3</b> Model development<span></span></a></li>
<li class="chapter" data-level="8.1.4" data-path="beginning-machine-learning.html"><a href="beginning-machine-learning.html#chl-a-model"><i class="fa fa-check"></i><b>8.1.4</b> Chl-a model<span></span></a></li>
<li class="chapter" data-level="8.1.5" data-path="beginning-machine-learning.html"><a href="beginning-machine-learning.html#tss-model"><i class="fa fa-check"></i><b>8.1.5</b> TSS Model<span></span></a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="beginning-machine-learning.html"><a href="beginning-machine-learning.html#q1"><i class="fa fa-check"></i><b>8.2</b> Q1)<span></span></a></li>
<li class="chapter" data-level="8.3" data-path="beginning-machine-learning.html"><a href="beginning-machine-learning.html#q2"><i class="fa fa-check"></i><b>8.3</b> Q2)<span></span></a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Analytics Portfolio</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="web-scraping-and-functions" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">4</span> Web Scraping and Functions<a href="web-scraping-and-functions.html#web-scraping-and-functions" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="simple-web-scraping" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Simple web scraping<a href="web-scraping-and-functions.html#simple-web-scraping" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>R can read html using either <strong>rvest</strong>, <strong>xml</strong>, or <strong>xml2</strong> packages. Here we are going to navigate to the Center for Snow and Avalance Studies <a href="https://snowstudies.org/archived-data/">Website</a> and read a table in. This table contains links to data we want to programatically download for three sites. We don’t know much about these sites, but they contain incredibly rich snow, temperature, and precipitation data.</p>
<div id="reading-an-html" class="section level3 hasAnchor" number="4.1.1">
<h3><span class="header-section-number">4.1.1</span> Reading an html<a href="web-scraping-and-functions.html#reading-an-html" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="extract-csv-links-from-webpage" class="section level4 hasAnchor" number="4.1.1.1">
<h4><span class="header-section-number">4.1.1.1</span> Extract CSV links from webpage<a href="web-scraping-and-functions.html#extract-csv-links-from-webpage" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="web-scraping-and-functions.html#cb15-1" aria-hidden="true" tabindex="-1"></a>site_url <span class="ot">&lt;-</span> <span class="st">&#39;https://snowstudies.org/archived-data/&#39;</span></span>
<span id="cb15-2"><a href="web-scraping-and-functions.html#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="web-scraping-and-functions.html#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Read the web url</span></span>
<span id="cb15-4"><a href="web-scraping-and-functions.html#cb15-4" aria-hidden="true" tabindex="-1"></a>webpage <span class="ot">&lt;-</span> <span class="fu">read_html</span>(site_url)</span>
<span id="cb15-5"><a href="web-scraping-and-functions.html#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="web-scraping-and-functions.html#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co">#See if we can extract tables and get the data that way</span></span>
<span id="cb15-7"><a href="web-scraping-and-functions.html#cb15-7" aria-hidden="true" tabindex="-1"></a>tables <span class="ot">&lt;-</span> webpage <span class="sc">%&gt;%</span></span>
<span id="cb15-8"><a href="web-scraping-and-functions.html#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_nodes</span>(<span class="st">&#39;table&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb15-9"><a href="web-scraping-and-functions.html#cb15-9" aria-hidden="true" tabindex="-1"></a>  magrittr<span class="sc">::</span><span class="fu">extract2</span>(<span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb15-10"><a href="web-scraping-and-functions.html#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_table</span>(<span class="at">fill =</span> <span class="cn">TRUE</span>)</span>
<span id="cb15-11"><a href="web-scraping-and-functions.html#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="co">#That didn&#39;t work, so let&#39;s try a different approach</span></span>
<span id="cb15-12"><a href="web-scraping-and-functions.html#cb15-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-13"><a href="web-scraping-and-functions.html#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="co">#Extract only weblinks and then the URLs!</span></span>
<span id="cb15-14"><a href="web-scraping-and-functions.html#cb15-14" aria-hidden="true" tabindex="-1"></a>links <span class="ot">&lt;-</span> webpage <span class="sc">%&gt;%</span></span>
<span id="cb15-15"><a href="web-scraping-and-functions.html#cb15-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_nodes</span>(<span class="st">&#39;a&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb15-16"><a href="web-scraping-and-functions.html#cb15-16" aria-hidden="true" tabindex="-1"></a>  .[<span class="fu">grepl</span>(<span class="st">&#39;24hr&#39;</span>,.)] <span class="sc">%&gt;%</span></span>
<span id="cb15-17"><a href="web-scraping-and-functions.html#cb15-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_attr</span>(<span class="st">&#39;href&#39;</span>)</span></code></pre></div>
</div>
</div>
<div id="data-download-1" class="section level3 hasAnchor" number="4.1.2">
<h3><span class="header-section-number">4.1.2</span> Data Download<a href="web-scraping-and-functions.html#data-download-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="download-data-in-a-for-loop" class="section level4 hasAnchor" number="4.1.2.1">
<h4><span class="header-section-number">4.1.2.1</span> Download data in a for loop<a href="web-scraping-and-functions.html#download-data-in-a-for-loop" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="web-scraping-and-functions.html#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Grab only the name of the file by splitting out on forward slashes</span></span>
<span id="cb16-2"><a href="web-scraping-and-functions.html#cb16-2" aria-hidden="true" tabindex="-1"></a>splits <span class="ot">&lt;-</span> <span class="fu">str_split_fixed</span>(links,<span class="st">&#39;/&#39;</span>,<span class="dv">8</span>)</span>
<span id="cb16-3"><a href="web-scraping-and-functions.html#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="web-scraping-and-functions.html#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Keep only the 8th column</span></span>
<span id="cb16-5"><a href="web-scraping-and-functions.html#cb16-5" aria-hidden="true" tabindex="-1"></a>dataset <span class="ot">&lt;-</span> splits[,<span class="dv">8</span>] </span>
<span id="cb16-6"><a href="web-scraping-and-functions.html#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="web-scraping-and-functions.html#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="co">#generate a file list for where the data goes</span></span>
<span id="cb16-8"><a href="web-scraping-and-functions.html#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="st">&quot;data&quot;</span>, <span class="at">showWarnings =</span> <span class="cn">FALSE</span>)</span>
<span id="cb16-9"><a href="web-scraping-and-functions.html#cb16-9" aria-hidden="true" tabindex="-1"></a>file_names <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&#39;data/&#39;</span>,dataset)</span>
<span id="cb16-10"><a href="web-scraping-and-functions.html#cb16-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-11"><a href="web-scraping-and-functions.html#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>){</span>
<span id="cb16-12"><a href="web-scraping-and-functions.html#cb16-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">download.file</span>(links[i],<span class="at">destfile=</span>file_names[i])</span>
<span id="cb16-13"><a href="web-scraping-and-functions.html#cb16-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-14"><a href="web-scraping-and-functions.html#cb16-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-15"><a href="web-scraping-and-functions.html#cb16-15" aria-hidden="true" tabindex="-1"></a>downloaded <span class="ot">&lt;-</span> <span class="fu">file.exists</span>(file_names)</span>
<span id="cb16-16"><a href="web-scraping-and-functions.html#cb16-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-17"><a href="web-scraping-and-functions.html#cb16-17" aria-hidden="true" tabindex="-1"></a>evaluate <span class="ot">&lt;-</span> <span class="sc">!</span><span class="fu">all</span>(downloaded)</span></code></pre></div>
</div>
<div id="download-data-in-a-map" class="section level4 hasAnchor" number="4.1.2.2">
<h4><span class="header-section-number">4.1.2.2</span> Download data in a map<a href="web-scraping-and-functions.html#download-data-in-a-map" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="web-scraping-and-functions.html#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Map version of the same for loop (downloading 3 files)</span></span>
<span id="cb17-2"><a href="web-scraping-and-functions.html#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(evaluate <span class="sc">==</span> T){</span>
<span id="cb17-3"><a href="web-scraping-and-functions.html#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map2</span>(links[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>],file_names[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>],download.file)</span>
<span id="cb17-4"><a href="web-scraping-and-functions.html#cb17-4" aria-hidden="true" tabindex="-1"></a>}<span class="cf">else</span>{<span class="fu">print</span>(<span class="st">&#39;data already downloaded&#39;</span>)}</span></code></pre></div>
</div>
</div>
<div id="data-read-in" class="section level3 hasAnchor" number="4.1.3">
<h3><span class="header-section-number">4.1.3</span> Data read-in<a href="web-scraping-and-functions.html#data-read-in" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="read-in-just-the-snow-data-as-a-loop" class="section level4 hasAnchor" number="4.1.3.1">
<h4><span class="header-section-number">4.1.3.1</span> Read in just the snow data as a loop<a href="web-scraping-and-functions.html#read-in-just-the-snow-data-as-a-loop" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="web-scraping-and-functions.html#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Pattern matching to only keep certain files</span></span>
<span id="cb18-2"><a href="web-scraping-and-functions.html#cb18-2" aria-hidden="true" tabindex="-1"></a>snow_files <span class="ot">&lt;-</span> file_names <span class="sc">%&gt;%</span></span>
<span id="cb18-3"><a href="web-scraping-and-functions.html#cb18-3" aria-hidden="true" tabindex="-1"></a>  .[<span class="sc">!</span><span class="fu">grepl</span>(<span class="st">&#39;SG_24&#39;</span>,.)] <span class="sc">%&gt;%</span></span>
<span id="cb18-4"><a href="web-scraping-and-functions.html#cb18-4" aria-hidden="true" tabindex="-1"></a>  .[<span class="sc">!</span><span class="fu">grepl</span>(<span class="st">&#39;PTSP&#39;</span>,.)]</span>
<span id="cb18-5"><a href="web-scraping-and-functions.html#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="web-scraping-and-functions.html#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co">#empty_data &lt;- list()</span></span>
<span id="cb18-7"><a href="web-scraping-and-functions.html#cb18-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-8"><a href="web-scraping-and-functions.html#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="do">## snow_data &lt;- for(i in 1:length(snow_files)){</span></span>
<span id="cb18-9"><a href="web-scraping-and-functions.html#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="do">##   empty_data[[i]] &lt;- read_csv(snow_files[i]) %&gt;%</span></span>
<span id="cb18-10"><a href="web-scraping-and-functions.html#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="do">##     select(Year,DOY,Sno_Height_M)</span></span>
<span id="cb18-11"><a href="web-scraping-and-functions.html#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="do">## }</span></span>
<span id="cb18-12"><a href="web-scraping-and-functions.html#cb18-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-13"><a href="web-scraping-and-functions.html#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="co">#snow_data_full &lt;- do.call(&#39;rbind&#39;,empty_data)</span></span>
<span id="cb18-14"><a href="web-scraping-and-functions.html#cb18-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-15"><a href="web-scraping-and-functions.html#cb18-15" aria-hidden="true" tabindex="-1"></a><span class="co">#summary(snow_data_full)</span></span></code></pre></div>
</div>
<div id="read-in-the-data-as-a-map-function" class="section level4 hasAnchor" number="4.1.3.2">
<h4><span class="header-section-number">4.1.3.2</span> Read in the data as a map function<a href="web-scraping-and-functions.html#read-in-the-data-as-a-map-function" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="web-scraping-and-functions.html#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="do">## define a function to read in list of csv files</span></span>
<span id="cb19-2"><a href="web-scraping-and-functions.html#cb19-2" aria-hidden="true" tabindex="-1"></a>our_snow_reader <span class="ot">&lt;-</span> <span class="cf">function</span>(file){</span>
<span id="cb19-3"><a href="web-scraping-and-functions.html#cb19-3" aria-hidden="true" tabindex="-1"></a>  name <span class="ot">=</span> <span class="fu">str_split_fixed</span>(file,<span class="st">&#39;/&#39;</span>,<span class="dv">2</span>)[,<span class="dv">2</span>] <span class="sc">%&gt;%</span></span>
<span id="cb19-4"><a href="web-scraping-and-functions.html#cb19-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gsub</span>(<span class="st">&#39;_24hr.csv&#39;</span>,<span class="st">&#39;&#39;</span>,.)</span>
<span id="cb19-5"><a href="web-scraping-and-functions.html#cb19-5" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(file) <span class="sc">%&gt;%</span></span>
<span id="cb19-6"><a href="web-scraping-and-functions.html#cb19-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(Year,DOY,Sno_Height_M) <span class="sc">%&gt;%</span></span>
<span id="cb19-7"><a href="web-scraping-and-functions.html#cb19-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">site =</span> name)</span>
<span id="cb19-8"><a href="web-scraping-and-functions.html#cb19-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-9"><a href="web-scraping-and-functions.html#cb19-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-10"><a href="web-scraping-and-functions.html#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="do">## use map to call function defined above</span></span>
<span id="cb19-11"><a href="web-scraping-and-functions.html#cb19-11" aria-hidden="true" tabindex="-1"></a>snow_data_full <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(snow_files,our_snow_reader)</span>
<span id="cb19-12"><a href="web-scraping-and-functions.html#cb19-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-13"><a href="web-scraping-and-functions.html#cb19-13" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(snow_data_full)</span></code></pre></div>
</div>
<div id="plot-snow-data" class="section level4 hasAnchor" number="4.1.3.3">
<h4><span class="header-section-number">4.1.3.3</span> Plot snow data<a href="web-scraping-and-functions.html#plot-snow-data" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="web-scraping-and-functions.html#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="do">## summarize snow data by year</span></span>
<span id="cb20-2"><a href="web-scraping-and-functions.html#cb20-2" aria-hidden="true" tabindex="-1"></a>snow_yearly <span class="ot">&lt;-</span> snow_data_full <span class="sc">%&gt;%</span></span>
<span id="cb20-3"><a href="web-scraping-and-functions.html#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Year,site) <span class="sc">%&gt;%</span></span>
<span id="cb20-4"><a href="web-scraping-and-functions.html#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean_height =</span> <span class="fu">mean</span>(Sno_Height_M,<span class="at">na.rm=</span>T))</span>
<span id="cb20-5"><a href="web-scraping-and-functions.html#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="do">## plot snow data</span></span>
<span id="cb20-6"><a href="web-scraping-and-functions.html#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(snow_yearly,<span class="fu">aes</span>(<span class="at">x=</span>Year,<span class="at">y=</span>mean_height,<span class="at">color=</span>site)) <span class="sc">+</span> </span>
<span id="cb20-7"><a href="web-scraping-and-functions.html#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb20-8"><a href="web-scraping-and-functions.html#cb20-8" aria-hidden="true" tabindex="-1"></a>  ggthemes<span class="sc">::</span><span class="fu">theme_few</span>() <span class="sc">+</span> </span>
<span id="cb20-9"><a href="web-scraping-and-functions.html#cb20-9" aria-hidden="true" tabindex="-1"></a>  ggthemes<span class="sc">::</span><span class="fu">scale_color_few</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
</div>
</div>
</div>
<div id="assignment-2" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> Assignment:<a href="web-scraping-and-functions.html#assignment-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="question-1-1" class="section level3 hasAnchor" number="4.2.1">
<h3><span class="header-section-number">4.2.1</span> Question 1<a href="web-scraping-and-functions.html#question-1-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Extract the meteorological data URLs. Here we want you to use the <code>rvest</code> package to get the URLs for the <code>SASP forcing</code> and <code>SBSP_forcing</code> meteorological datasets.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="web-scraping-and-functions.html#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">#use the rvest package to scrape the url</span></span>
<span id="cb21-2"><a href="web-scraping-and-functions.html#cb21-2" aria-hidden="true" tabindex="-1"></a>site_url <span class="ot">&lt;-</span> <span class="st">&quot;https://snowstudies.org/archived-data/&quot;</span></span>
<span id="cb21-3"><a href="web-scraping-and-functions.html#cb21-3" aria-hidden="true" tabindex="-1"></a>webpage <span class="ot">&lt;-</span> <span class="fu">read_html</span>(site_url)</span>
<span id="cb21-4"><a href="web-scraping-and-functions.html#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="web-scraping-and-functions.html#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co">#find weblinks and extract the urls</span></span>
<span id="cb21-6"><a href="web-scraping-and-functions.html#cb21-6" aria-hidden="true" tabindex="-1"></a>links <span class="ot">&lt;-</span> webpage <span class="sc">%&gt;%</span></span>
<span id="cb21-7"><a href="web-scraping-and-functions.html#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_nodes</span>(<span class="st">&quot;a&quot;</span>) <span class="sc">%&gt;%</span> <span class="do">## &lt;a&gt; tag defines a hyperlink</span></span>
<span id="cb21-8"><a href="web-scraping-and-functions.html#cb21-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_attr</span>(<span class="st">&quot;href&quot;</span>) <span class="sc">%&gt;%</span> <span class="do">## href is the URL the link goes to</span></span>
<span id="cb21-9"><a href="web-scraping-and-functions.html#cb21-9" aria-hidden="true" tabindex="-1"></a>  .[<span class="fu">grepl</span>(<span class="st">&quot;.txt&quot;</span>, .)] <span class="sc">%&gt;%</span>  <span class="do">## only pull txt files</span></span>
<span id="cb21-10"><a href="web-scraping-and-functions.html#cb21-10" aria-hidden="true" tabindex="-1"></a>  .[<span class="fu">grepl</span>(<span class="st">&quot;SASP_Forcing|SBSP_Forcing&quot;</span>, .)] <span class="do">## could also use just &quot;_Forcing&quot; but question specifically asks for only SASP and SBSP (in case site is updated later to include a new _Forcing file)</span></span></code></pre></div>
</div>
<div id="question-2-1" class="section level3 hasAnchor" number="4.2.2">
<h3><span class="header-section-number">4.2.2</span> Question 2<a href="web-scraping-and-functions.html#question-2-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Download the meteorological data. Use the <code>download_file</code> and <code>str_split_fixed</code> commands to download the data and save it in your data folder. You can use a for loop or a map function.</p>
<div id="download-with-for-loop" class="section level4 hasAnchor" number="4.2.2.1">
<h4><span class="header-section-number">4.2.2.1</span> Download with for loop<a href="web-scraping-and-functions.html#download-with-for-loop" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="web-scraping-and-functions.html#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="do">## extract dataset names</span></span>
<span id="cb22-2"><a href="web-scraping-and-functions.html#cb22-2" aria-hidden="true" tabindex="-1"></a>splits <span class="ot">&lt;-</span> <span class="fu">str_split_fixed</span>(links, <span class="st">&quot;/&quot;</span>, <span class="at">n =</span> <span class="dv">8</span>)</span>
<span id="cb22-3"><a href="web-scraping-and-functions.html#cb22-3" aria-hidden="true" tabindex="-1"></a>dataset <span class="ot">&lt;-</span>  splits[,<span class="dv">8</span>]</span>
<span id="cb22-4"><a href="web-scraping-and-functions.html#cb22-4" aria-hidden="true" tabindex="-1"></a>file_names <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&#39;data/&#39;</span>,dataset)</span>
<span id="cb22-5"><a href="web-scraping-and-functions.html#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="web-scraping-and-functions.html#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="do">## use download_file to create local copy of data with for loop</span></span>
<span id="cb22-7"><a href="web-scraping-and-functions.html#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(links)){</span>
<span id="cb22-8"><a href="web-scraping-and-functions.html#cb22-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">download.file</span>(links[i],<span class="at">destfile=</span>file_names[i])</span>
<span id="cb22-9"><a href="web-scraping-and-functions.html#cb22-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="download-with-map-function" class="section level4 hasAnchor" number="4.2.2.2">
<h4><span class="header-section-number">4.2.2.2</span> Download with map function<a href="web-scraping-and-functions.html#download-with-map-function" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="web-scraping-and-functions.html#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="do">## with map function</span></span>
<span id="cb23-2"><a href="web-scraping-and-functions.html#cb23-2" aria-hidden="true" tabindex="-1"></a>downloaded <span class="ot">&lt;-</span> <span class="fu">file.exists</span>(file_names)</span>
<span id="cb23-3"><a href="web-scraping-and-functions.html#cb23-3" aria-hidden="true" tabindex="-1"></a>evaluate <span class="ot">&lt;-</span> <span class="sc">!</span><span class="fu">all</span>(downloaded)</span>
<span id="cb23-4"><a href="web-scraping-and-functions.html#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(evaluate <span class="sc">==</span> T){</span>
<span id="cb23-5"><a href="web-scraping-and-functions.html#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map2</span>(links[<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(links)], file_names[<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(links)], download.file)</span>
<span id="cb23-6"><a href="web-scraping-and-functions.html#cb23-6" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span>{<span class="fu">print</span>(<span class="st">&#39;data already downloaded&#39;</span>)}</span></code></pre></div>
</div>
</div>
<div id="question-3-1" class="section level3 hasAnchor" number="4.2.3">
<h3><span class="header-section-number">4.2.3</span> Question 3<a href="web-scraping-and-functions.html#question-3-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Write a custom function to read in the data and append a site column to the data.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="web-scraping-and-functions.html#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="do">## this code grabs the variable names from the metadata pdf file</span></span>
<span id="cb24-2"><a href="web-scraping-and-functions.html#cb24-2" aria-hidden="true" tabindex="-1"></a>headers <span class="ot">&lt;-</span> <span class="fu">pdf_text</span>(<span class="st">&#39;https://snowstudies.org/wp-content/uploads/2022/02/Serially-Complete-Metadata-text08.pdf&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb24-3"><a href="web-scraping-and-functions.html#cb24-3" aria-hidden="true" tabindex="-1"></a>  readr<span class="sc">::</span><span class="fu">read_lines</span>(.) <span class="sc">%&gt;%</span></span>
<span id="cb24-4"><a href="web-scraping-and-functions.html#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">trimws</span>(.) <span class="sc">%&gt;%</span></span>
<span id="cb24-5"><a href="web-scraping-and-functions.html#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_split_fixed</span>(.,<span class="st">&#39;</span><span class="sc">\\</span><span class="st">.&#39;</span>,<span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb24-6"><a href="web-scraping-and-functions.html#cb24-6" aria-hidden="true" tabindex="-1"></a>  .[,<span class="dv">2</span>] <span class="sc">%&gt;%</span></span>
<span id="cb24-7"><a href="web-scraping-and-functions.html#cb24-7" aria-hidden="true" tabindex="-1"></a>  .[<span class="dv">1</span><span class="sc">:</span><span class="dv">26</span>] <span class="sc">%&gt;%</span></span>
<span id="cb24-8"><a href="web-scraping-and-functions.html#cb24-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_trim</span>(<span class="at">side =</span> <span class="st">&quot;left&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb24-9"><a href="web-scraping-and-functions.html#cb24-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">make.names</span>(<span class="at">unique =</span> <span class="cn">FALSE</span>, <span class="at">allow_ =</span> <span class="cn">TRUE</span>)</span>
<span id="cb24-10"><a href="web-scraping-and-functions.html#cb24-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-11"><a href="web-scraping-and-functions.html#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="do">## create function to read data</span></span>
<span id="cb24-12"><a href="web-scraping-and-functions.html#cb24-12" aria-hidden="true" tabindex="-1"></a>my_data_reader <span class="ot">&lt;-</span> <span class="cf">function</span>(file){</span>
<span id="cb24-13"><a href="web-scraping-and-functions.html#cb24-13" aria-hidden="true" tabindex="-1"></a>  <span class="do">## extract name of file</span></span>
<span id="cb24-14"><a href="web-scraping-and-functions.html#cb24-14" aria-hidden="true" tabindex="-1"></a>  fname <span class="ot">&lt;-</span> <span class="fu">substr</span>(file, <span class="fu">str_locate</span>(file, <span class="st">&quot;SBB_&quot;</span>)[<span class="dv">2</span>]<span class="sc">+</span><span class="dv">1</span>, <span class="fu">str_locate</span>(file, <span class="st">&quot;SBB_&quot;</span>)[<span class="dv">2</span>]<span class="sc">+</span><span class="dv">4</span>)</span>
<span id="cb24-15"><a href="web-scraping-and-functions.html#cb24-15" aria-hidden="true" tabindex="-1"></a>  <span class="do">## read in data</span></span>
<span id="cb24-16"><a href="web-scraping-and-functions.html#cb24-16" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">read_table</span>(file</span>
<span id="cb24-17"><a href="web-scraping-and-functions.html#cb24-17" aria-hidden="true" tabindex="-1"></a>                  , <span class="at">skip =</span> <span class="dv">4</span></span>
<span id="cb24-18"><a href="web-scraping-and-functions.html#cb24-18" aria-hidden="true" tabindex="-1"></a>                  , <span class="at">col_names =</span> headers</span>
<span id="cb24-19"><a href="web-scraping-and-functions.html#cb24-19" aria-hidden="true" tabindex="-1"></a>                  , <span class="at">skip_empty_rows =</span> <span class="cn">TRUE</span></span>
<span id="cb24-20"><a href="web-scraping-and-functions.html#cb24-20" aria-hidden="true" tabindex="-1"></a>                  , <span class="at">na =</span> <span class="fu">c</span>(<span class="st">&quot;-9999.000&quot;</span>, <span class="st">&quot;&quot;</span>)</span>
<span id="cb24-21"><a href="web-scraping-and-functions.html#cb24-21" aria-hidden="true" tabindex="-1"></a>                ) <span class="sc">%&gt;%</span> </span>
<span id="cb24-22"><a href="web-scraping-and-functions.html#cb24-22" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(<span class="st">&quot;year&quot;</span>, <span class="st">&quot;month&quot;</span>, <span class="st">&quot;day&quot;</span>, <span class="st">&quot;hour&quot;</span>, <span class="st">&quot;air.temp..K.&quot;</span>, <span class="st">&quot;precip..kg.m.2.s.1.&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb24-23"><a href="web-scraping-and-functions.html#cb24-23" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">site =</span> fname)</span>
<span id="cb24-24"><a href="web-scraping-and-functions.html#cb24-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df)</span>
<span id="cb24-25"><a href="web-scraping-and-functions.html#cb24-25" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="question-4-1" class="section level3 hasAnchor" number="4.2.4">
<h3><span class="header-section-number">4.2.4</span> Question 4<a href="web-scraping-and-functions.html#question-4-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Use the <code>map</code> function to read in both meteorological files. Display a summary of your tibble.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="web-scraping-and-functions.html#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="do">## read in data using function created above</span></span>
<span id="cb25-2"><a href="web-scraping-and-functions.html#cb25-2" aria-hidden="true" tabindex="-1"></a>metoc_hourly_full <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(file_names, my_data_reader)</span>
<span id="cb25-3"><a href="web-scraping-and-functions.html#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="do">## show data summary</span></span>
<span id="cb25-4"><a href="web-scraping-and-functions.html#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(metoc_hourly_full)</span></code></pre></div>
<pre><code>##       year          month             day             hour      
##  Min.   :2003   Min.   : 1.000   Min.   : 1.00   Min.   : 0.00  
##  1st Qu.:2005   1st Qu.: 3.000   1st Qu.: 8.00   1st Qu.: 5.75  
##  Median :2007   Median : 6.000   Median :16.00   Median :11.50  
##  Mean   :2007   Mean   : 6.472   Mean   :15.76   Mean   :11.50  
##  3rd Qu.:2009   3rd Qu.: 9.000   3rd Qu.:23.00   3rd Qu.:17.25  
##  Max.   :2011   Max.   :12.000   Max.   :31.00   Max.   :23.00  
##   air.temp..K.   precip..kg.m.2.s.1.     site          
##  Min.   :242.1   Min.   :0.000e+00   Length:138336     
##  1st Qu.:265.8   1st Qu.:0.000e+00   Class :character  
##  Median :272.6   Median :0.000e+00   Mode  :character  
##  Mean   :272.6   Mean   :3.838e-05                     
##  3rd Qu.:279.7   3rd Qu.:0.000e+00                     
##  Max.   :295.8   Max.   :6.111e-03</code></pre>
</div>
<div id="question-5-1" class="section level3 hasAnchor" number="4.2.5">
<h3><span class="header-section-number">4.2.5</span> Question 5<a href="web-scraping-and-functions.html#question-5-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Make a line plot of mean temp by year by site (using the <code>air temp [K]</code> variable). Is there anything suspicious in the plot? Adjust your filtering if needed.</p>
<p><span style="color: blue;">This initial plot of mean hourly temperature by year shows a much lower average temperature for both sites in the first year of the data (2003).</span></p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="web-scraping-and-functions.html#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="do">## summarize mean temp by year, site</span></span>
<span id="cb27-2"><a href="web-scraping-and-functions.html#cb27-2" aria-hidden="true" tabindex="-1"></a>metoc_site_year <span class="ot">&lt;-</span> metoc_hourly_full <span class="sc">%&gt;%</span> </span>
<span id="cb27-3"><a href="web-scraping-and-functions.html#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(site, year) <span class="sc">%&gt;%</span> </span>
<span id="cb27-4"><a href="web-scraping-and-functions.html#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_temp =</span> <span class="fu">mean</span>(air.temp..K., <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb27-5"><a href="web-scraping-and-functions.html#cb27-5" aria-hidden="true" tabindex="-1"></a>            , <span class="at">cnt =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb27-6"><a href="web-scraping-and-functions.html#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(site, year)</span>
<span id="cb27-7"><a href="web-scraping-and-functions.html#cb27-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-8"><a href="web-scraping-and-functions.html#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="do">## function to create line graph of temp by year for each site</span></span>
<span id="cb27-9"><a href="web-scraping-and-functions.html#cb27-9" aria-hidden="true" tabindex="-1"></a>my_line_graph <span class="ot">&lt;-</span> <span class="cf">function</span>(my_data){</span>
<span id="cb27-10"><a href="web-scraping-and-functions.html#cb27-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(</span>
<span id="cb27-11"><a href="web-scraping-and-functions.html#cb27-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(my_data, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> mean_temp, <span class="at">color =</span> site)) <span class="sc">+</span></span>
<span id="cb27-12"><a href="web-scraping-and-functions.html#cb27-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">alpha=</span><span class="fl">0.8</span>, <span class="at">size =</span> <span class="fl">1.3</span>) <span class="sc">+</span> </span>
<span id="cb27-13"><a href="web-scraping-and-functions.html#cb27-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">alpha=</span><span class="fl">0.8</span>, <span class="at">size =</span> <span class="fl">1.3</span>) <span class="sc">+</span> </span>
<span id="cb27-14"><a href="web-scraping-and-functions.html#cb27-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="fu">min</span>(metoc_hourly_full<span class="sc">$</span>year), <span class="fu">max</span>(metoc_hourly_full<span class="sc">$</span>year)), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1900</span>, <span class="dv">2200</span>, <span class="at">by =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb27-15"><a href="web-scraping-and-functions.html#cb27-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb27-16"><a href="web-scraping-and-functions.html#cb27-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">&quot;Average Temperature by Year&quot;</span></span>
<span id="cb27-17"><a href="web-scraping-and-functions.html#cb27-17" aria-hidden="true" tabindex="-1"></a>        , <span class="at">subtitle =</span> <span class="st">&quot;Swamp Angel Study Plot and Senator Beck Study Plot&quot;</span></span>
<span id="cb27-18"><a href="web-scraping-and-functions.html#cb27-18" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb27-19"><a href="web-scraping-and-functions.html#cb27-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">&quot;Mean Temp. (K)&quot;</span>) <span class="sc">+</span></span>
<span id="cb27-20"><a href="web-scraping-and-functions.html#cb27-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb27-21"><a href="web-scraping-and-functions.html#cb27-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Dark2&quot;</span>) <span class="sc">+</span></span>
<span id="cb27-22"><a href="web-scraping-and-functions.html#cb27-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb27-23"><a href="web-scraping-and-functions.html#cb27-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb27-24"><a href="web-scraping-and-functions.html#cb27-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position=</span><span class="st">&quot;bottom&quot;</span></span>
<span id="cb27-25"><a href="web-scraping-and-functions.html#cb27-25" aria-hidden="true" tabindex="-1"></a>      , <span class="at">legend.box =</span> <span class="st">&quot;horizontal&quot;</span></span>
<span id="cb27-26"><a href="web-scraping-and-functions.html#cb27-26" aria-hidden="true" tabindex="-1"></a>      , <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>)</span>
<span id="cb27-27"><a href="web-scraping-and-functions.html#cb27-27" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb27-28"><a href="web-scraping-and-functions.html#cb27-28" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb27-29"><a href="web-scraping-and-functions.html#cb27-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-30"><a href="web-scraping-and-functions.html#cb27-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-31"><a href="web-scraping-and-functions.html#cb27-31" aria-hidden="true" tabindex="-1"></a><span class="do">## plot with full data</span></span>
<span id="cb27-32"><a href="web-scraping-and-functions.html#cb27-32" aria-hidden="true" tabindex="-1"></a><span class="fu">my_line_graph</span>(metoc_site_year)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-28-1.png" width="768" /></p>
<p><span style="color: blue;">Looking at a count of the records by year reveals that the first and last year of the data do not include a full year of data. As this is hourly data, a full year of data should have 365*24 = 8,760 records (8,784 records on leap year).</span></p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="web-scraping-and-functions.html#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="do">## investigate what is happening in 2003 by looking at record counts</span></span>
<span id="cb28-2"><a href="web-scraping-and-functions.html#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(metoc_site_year, <span class="fu">aes</span>(<span class="at">x=</span> <span class="fu">as.character</span>(year), <span class="at">y=</span>cnt, <span class="at">fill =</span> site)) <span class="sc">+</span> </span>
<span id="cb28-3"><a href="web-scraping-and-functions.html#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">alpha=</span><span class="fl">0.8</span>, <span class="at">width =</span> <span class="fl">0.7</span>) <span class="sc">+</span> </span>
<span id="cb28-4"><a href="web-scraping-and-functions.html#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> scales<span class="sc">::</span><span class="fu">comma</span>(cnt)), <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>, <span class="at">angle =</span> <span class="dv">90</span>, <span class="at">hjust=</span><span class="st">&quot;top&quot;</span>) <span class="sc">+</span></span>
<span id="cb28-5"><a href="web-scraping-and-functions.html#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(. <span class="sc">~</span> site) <span class="sc">+</span></span>
<span id="cb28-6"><a href="web-scraping-and-functions.html#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> <span class="fu">label_comma</span>()) <span class="sc">+</span></span>
<span id="cb28-7"><a href="web-scraping-and-functions.html#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb28-8"><a href="web-scraping-and-functions.html#cb28-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">&quot;Number of hourly records by year&quot;</span></span>
<span id="cb28-9"><a href="web-scraping-and-functions.html#cb28-9" aria-hidden="true" tabindex="-1"></a>      , <span class="at">subtitle =</span> <span class="st">&quot;Swamp Angel Study Plot and Senator Beck Study Plot&quot;</span></span>
<span id="cb28-10"><a href="web-scraping-and-functions.html#cb28-10" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb28-11"><a href="web-scraping-and-functions.html#cb28-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Count Obs.&quot;</span>) <span class="sc">+</span></span>
<span id="cb28-12"><a href="web-scraping-and-functions.html#cb28-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb28-13"><a href="web-scraping-and-functions.html#cb28-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Dark2&quot;</span>) <span class="sc">+</span></span>
<span id="cb28-14"><a href="web-scraping-and-functions.html#cb28-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb28-15"><a href="web-scraping-and-functions.html#cb28-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb28-16"><a href="web-scraping-and-functions.html#cb28-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position=</span><span class="st">&quot;none&quot;</span></span>
<span id="cb28-17"><a href="web-scraping-and-functions.html#cb28-17" aria-hidden="true" tabindex="-1"></a>    , <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust=</span><span class="fl">0.2</span>)</span>
<span id="cb28-18"><a href="web-scraping-and-functions.html#cb28-18" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-29-1.png" width="768" /></p>
<p><span style="color: blue;">We can filter out yearly records that have incomplete data and plot the average hourly temperature by year again.</span></p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="web-scraping-and-functions.html#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="do">## line graph of temp by year for each site filtered for complete data</span></span>
<span id="cb29-2"><a href="web-scraping-and-functions.html#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">my_line_graph</span>(metoc_site_year <span class="sc">%&gt;%</span> <span class="fu">filter</span>(cnt <span class="sc">&gt;=</span> <span class="dv">8760</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-30-1.png" width="768" /></p>
</div>
<div id="question-6" class="section level3 hasAnchor" number="4.2.6">
<h3><span class="header-section-number">4.2.6</span> Question 6<a href="web-scraping-and-functions.html#question-6" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Write a function that makes line plots of monthly average temperature at each site for a given year. Use a for loop to make these plots for 2005 to 2010. Are monthly average temperatures at the Senator Beck Study Plot ever warmer than the Snow Angel Study Plot?
Hint: <a href="https://ggplot2.tidyverse.org/reference/print.ggplot.html" class="uri">https://ggplot2.tidyverse.org/reference/print.ggplot.html</a></p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="web-scraping-and-functions.html#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="do">## summarize mean temp by year, month, site</span></span>
<span id="cb30-2"><a href="web-scraping-and-functions.html#cb30-2" aria-hidden="true" tabindex="-1"></a>metoc_site_year_mo <span class="ot">&lt;-</span> metoc_hourly_full <span class="sc">%&gt;%</span> </span>
<span id="cb30-3"><a href="web-scraping-and-functions.html#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(site, year, month) <span class="sc">%&gt;%</span> </span>
<span id="cb30-4"><a href="web-scraping-and-functions.html#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_temp =</span> <span class="fu">mean</span>(air.temp..K., <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb30-5"><a href="web-scraping-and-functions.html#cb30-5" aria-hidden="true" tabindex="-1"></a>            , <span class="at">cnt =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb30-6"><a href="web-scraping-and-functions.html#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(site, year, month)</span>
<span id="cb30-7"><a href="web-scraping-and-functions.html#cb30-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-8"><a href="web-scraping-and-functions.html#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="do">## function to create line graph of temp by year for each site</span></span>
<span id="cb30-9"><a href="web-scraping-and-functions.html#cb30-9" aria-hidden="true" tabindex="-1"></a>my_line_graph_month <span class="ot">&lt;-</span> <span class="cf">function</span>(my_data, my_year){</span>
<span id="cb30-10"><a href="web-scraping-and-functions.html#cb30-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">#generate title</span></span>
<span id="cb30-11"><a href="web-scraping-and-functions.html#cb30-11" aria-hidden="true" tabindex="-1"></a>  my_title <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">as.character</span>(my_year), <span class="st">&quot; Average Temperature by Month&quot;</span>)</span>
<span id="cb30-12"><a href="web-scraping-and-functions.html#cb30-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">#plot</span></span>
<span id="cb30-13"><a href="web-scraping-and-functions.html#cb30-13" aria-hidden="true" tabindex="-1"></a>  (</span>
<span id="cb30-14"><a href="web-scraping-and-functions.html#cb30-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(my_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year<span class="sc">==</span>my_year), <span class="fu">aes</span>(<span class="at">x =</span> (month), <span class="at">y =</span> mean_temp, <span class="at">color =</span> site)) <span class="sc">+</span></span>
<span id="cb30-15"><a href="web-scraping-and-functions.html#cb30-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">alpha=</span><span class="fl">0.8</span>, <span class="at">size =</span> <span class="fl">1.3</span>) <span class="sc">+</span> </span>
<span id="cb30-16"><a href="web-scraping-and-functions.html#cb30-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">alpha=</span><span class="fl">0.8</span>, <span class="at">size =</span> <span class="fl">1.3</span>) <span class="sc">+</span> </span>
<span id="cb30-17"><a href="web-scraping-and-functions.html#cb30-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_discrete</span>(<span class="at">limits=</span>month.abb) <span class="sc">+</span></span>
<span id="cb30-18"><a href="web-scraping-and-functions.html#cb30-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb30-19"><a href="web-scraping-and-functions.html#cb30-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> my_title</span>
<span id="cb30-20"><a href="web-scraping-and-functions.html#cb30-20" aria-hidden="true" tabindex="-1"></a>        , <span class="at">subtitle =</span> <span class="st">&quot;Swamp Angel Study Plot and Senator Beck Study Plot&quot;</span></span>
<span id="cb30-21"><a href="web-scraping-and-functions.html#cb30-21" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb30-22"><a href="web-scraping-and-functions.html#cb30-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">&quot;Mean Temp. (K)&quot;</span>) <span class="sc">+</span></span>
<span id="cb30-23"><a href="web-scraping-and-functions.html#cb30-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb30-24"><a href="web-scraping-and-functions.html#cb30-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Dark2&quot;</span>) <span class="sc">+</span></span>
<span id="cb30-25"><a href="web-scraping-and-functions.html#cb30-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb30-26"><a href="web-scraping-and-functions.html#cb30-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb30-27"><a href="web-scraping-and-functions.html#cb30-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position=</span><span class="st">&quot;bottom&quot;</span></span>
<span id="cb30-28"><a href="web-scraping-and-functions.html#cb30-28" aria-hidden="true" tabindex="-1"></a>      , <span class="at">legend.box =</span> <span class="st">&quot;horizontal&quot;</span></span>
<span id="cb30-29"><a href="web-scraping-and-functions.html#cb30-29" aria-hidden="true" tabindex="-1"></a>      , <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>)</span>
<span id="cb30-30"><a href="web-scraping-and-functions.html#cb30-30" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb30-31"><a href="web-scraping-and-functions.html#cb30-31" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb30-32"><a href="web-scraping-and-functions.html#cb30-32" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-33"><a href="web-scraping-and-functions.html#cb30-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-34"><a href="web-scraping-and-functions.html#cb30-34" aria-hidden="true" tabindex="-1"></a><span class="do">## plot with loop to create a plot for each year</span></span>
<span id="cb30-35"><a href="web-scraping-and-functions.html#cb30-35" aria-hidden="true" tabindex="-1"></a>my_years <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2005</span><span class="sc">:</span><span class="dv">2010</span>)</span>
<span id="cb30-36"><a href="web-scraping-and-functions.html#cb30-36" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(my_years)) {</span>
<span id="cb30-37"><a href="web-scraping-and-functions.html#cb30-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>( <span class="fu">my_line_graph_month</span>(metoc_site_year_mo, my_years[i]) )</span>
<span id="cb30-38"><a href="web-scraping-and-functions.html#cb30-38" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-31-1.png" width="576" /><img src="_main_files/figure-html/unnamed-chunk-31-2.png" width="576" /><img src="_main_files/figure-html/unnamed-chunk-31-3.png" width="576" /><img src="_main_files/figure-html/unnamed-chunk-31-4.png" width="576" /><img src="_main_files/figure-html/unnamed-chunk-31-5.png" width="576" /><img src="_main_files/figure-html/unnamed-chunk-31-6.png" width="576" /></p>
<div id="a-better-way" class="section level4 hasAnchor" number="4.2.6.1">
<h4><span class="header-section-number">4.2.6.1</span> A better way?<a href="web-scraping-and-functions.html#a-better-way" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><span style="color: blue;">Producing an individual chart for each year of interest can also be accomplished by using the <code>facet_grid</code> option in <code>ggplot</code>. With this option there is no need to write a loop to produce an individual graph for each year.</span></p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="web-scraping-and-functions.html#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co">#plot each year using facet_grid </span></span>
<span id="cb31-2"><a href="web-scraping-and-functions.html#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(metoc_site_year_mo <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">%in%</span> my_years), <span class="fu">aes</span>(<span class="at">x =</span> (month), <span class="at">y =</span> mean_temp, <span class="at">color =</span> site)) <span class="sc">+</span></span>
<span id="cb31-3"><a href="web-scraping-and-functions.html#cb31-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">alpha=</span><span class="fl">0.8</span>, <span class="at">size =</span> <span class="fl">0.9</span>) <span class="sc">+</span> </span>
<span id="cb31-4"><a href="web-scraping-and-functions.html#cb31-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">alpha=</span><span class="fl">0.8</span>, <span class="at">size =</span> <span class="fl">0.9</span>) <span class="sc">+</span> </span>
<span id="cb31-5"><a href="web-scraping-and-functions.html#cb31-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(. <span class="sc">~</span> year) <span class="sc">+</span></span>
<span id="cb31-6"><a href="web-scraping-and-functions.html#cb31-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_discrete</span>(<span class="at">limits=</span>month.abb) <span class="sc">+</span></span>
<span id="cb31-7"><a href="web-scraping-and-functions.html#cb31-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb31-8"><a href="web-scraping-and-functions.html#cb31-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">&quot;2005-2010 Average Temperature by Month&quot;</span></span>
<span id="cb31-9"><a href="web-scraping-and-functions.html#cb31-9" aria-hidden="true" tabindex="-1"></a>        , <span class="at">subtitle =</span> <span class="st">&quot;Swamp Angel Study Plot and Senator Beck Study Plot&quot;</span></span>
<span id="cb31-10"><a href="web-scraping-and-functions.html#cb31-10" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb31-11"><a href="web-scraping-and-functions.html#cb31-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">&quot;Mean Temp. (K)&quot;</span>) <span class="sc">+</span></span>
<span id="cb31-12"><a href="web-scraping-and-functions.html#cb31-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb31-13"><a href="web-scraping-and-functions.html#cb31-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Dark2&quot;</span>) <span class="sc">+</span></span>
<span id="cb31-14"><a href="web-scraping-and-functions.html#cb31-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb31-15"><a href="web-scraping-and-functions.html#cb31-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb31-16"><a href="web-scraping-and-functions.html#cb31-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position=</span><span class="st">&quot;bottom&quot;</span></span>
<span id="cb31-17"><a href="web-scraping-and-functions.html#cb31-17" aria-hidden="true" tabindex="-1"></a>      , <span class="at">legend.box =</span> <span class="st">&quot;horizontal&quot;</span></span>
<span id="cb31-18"><a href="web-scraping-and-functions.html#cb31-18" aria-hidden="true" tabindex="-1"></a>      , <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>, <span class="at">angle =</span> <span class="dv">90</span>)</span>
<span id="cb31-19"><a href="web-scraping-and-functions.html#cb31-19" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-32-1.png" width="864" /></p>
</div>
</div>
<div id="bonus-question-1-1" class="section level3 hasAnchor" number="4.2.7">
<h3><span class="header-section-number">4.2.7</span> Bonus Question 1<a href="web-scraping-and-functions.html#bonus-question-1-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Make a plot of average daily precipitation by day of year (averaged across all available years). Color each site.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="web-scraping-and-functions.html#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="do">## summarize total precipitation by date, site</span></span>
<span id="cb32-2"><a href="web-scraping-and-functions.html#cb32-2" aria-hidden="true" tabindex="-1"></a>metoc_doy_site <span class="ot">&lt;-</span> metoc_hourly_full <span class="sc">%&gt;%</span></span>
<span id="cb32-3"><a href="web-scraping-and-functions.html#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date_id =</span> <span class="fu">make_date</span>(year, month, day)</span>
<span id="cb32-4"><a href="web-scraping-and-functions.html#cb32-4" aria-hidden="true" tabindex="-1"></a>         , <span class="at">day_of_year =</span> <span class="fu">yday</span>(date_id)</span>
<span id="cb32-5"><a href="web-scraping-and-functions.html#cb32-5" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb32-6"><a href="web-scraping-and-functions.html#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(site, date_id, day_of_year) <span class="sc">%&gt;%</span> </span>
<span id="cb32-7"><a href="web-scraping-and-functions.html#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">tot_precip =</span> <span class="fu">sum</span>(precip..kg.m.<span class="fl">2.</span>s.<span class="fl">1.</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb32-8"><a href="web-scraping-and-functions.html#cb32-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(site, day_of_year) <span class="sc">%&gt;%</span> <span class="do">## now take the avg of total daily precip by doy</span></span>
<span id="cb32-9"><a href="web-scraping-and-functions.html#cb32-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_daily_precip =</span> <span class="fu">mean</span>(tot_precip, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb32-10"><a href="web-scraping-and-functions.html#cb32-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(site, day_of_year) <span class="sc">%&gt;%</span> </span>
<span id="cb32-11"><a href="web-scraping-and-functions.html#cb32-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month_day =</span> <span class="fu">as.Date</span>(day_of_year, <span class="at">origin =</span> <span class="st">&quot;1999-12-31&quot;</span>)) <span class="do">## this date will make for plotting with date label</span></span>
<span id="cb32-12"><a href="web-scraping-and-functions.html#cb32-12" aria-hidden="true" tabindex="-1"></a>  <span class="do">## note to choose a leap year above to handle years with 366 days</span></span>
<span id="cb32-13"><a href="web-scraping-and-functions.html#cb32-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-14"><a href="web-scraping-and-functions.html#cb32-14" aria-hidden="true" tabindex="-1"></a><span class="do">## plot mean precip by doy</span></span>
<span id="cb32-15"><a href="web-scraping-and-functions.html#cb32-15" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(metoc_doy_site, <span class="fu">aes</span>(<span class="at">x =</span> month_day, <span class="at">y =</span> mean_daily_precip, <span class="at">color =</span> site)) <span class="sc">+</span></span>
<span id="cb32-16"><a href="web-scraping-and-functions.html#cb32-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha=</span><span class="fl">0.5</span>, <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb32-17"><a href="web-scraping-and-functions.html#cb32-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha=</span><span class="fl">0.5</span>, <span class="at">size =</span> <span class="fl">0.4</span>) <span class="sc">+</span> </span>
<span id="cb32-18"><a href="web-scraping-and-functions.html#cb32-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> loess, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">alpha=</span><span class="dv">1</span>, <span class="at">size =</span> <span class="fl">0.9</span>) <span class="sc">+</span> </span>
<span id="cb32-19"><a href="web-scraping-and-functions.html#cb32-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(. <span class="sc">~</span> site) <span class="sc">+</span></span>
<span id="cb32-20"><a href="web-scraping-and-functions.html#cb32-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(<span class="at">date_labels =</span> <span class="st">&quot;%b-%d&quot;</span>, <span class="at">date_minor_breaks =</span> <span class="st">&quot;1 month&quot;</span>) <span class="sc">+</span></span>
<span id="cb32-21"><a href="web-scraping-and-functions.html#cb32-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb32-22"><a href="web-scraping-and-functions.html#cb32-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">&quot;Average Precipitation by Day of Year&quot;</span></span>
<span id="cb32-23"><a href="web-scraping-and-functions.html#cb32-23" aria-hidden="true" tabindex="-1"></a>      , <span class="at">subtitle =</span> <span class="st">&quot;Swamp Angel Study Plot and Senator Beck Study Plot&quot;</span></span>
<span id="cb32-24"><a href="web-scraping-and-functions.html#cb32-24" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb32-25"><a href="web-scraping-and-functions.html#cb32-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Mean Precip. (kg/m2/s)&quot;</span>) <span class="sc">+</span></span>
<span id="cb32-26"><a href="web-scraping-and-functions.html#cb32-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb32-27"><a href="web-scraping-and-functions.html#cb32-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Dark2&quot;</span>) <span class="sc">+</span></span>
<span id="cb32-28"><a href="web-scraping-and-functions.html#cb32-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb32-29"><a href="web-scraping-and-functions.html#cb32-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb32-30"><a href="web-scraping-and-functions.html#cb32-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position=</span><span class="st">&quot;none&quot;</span></span>
<span id="cb32-31"><a href="web-scraping-and-functions.html#cb32-31" aria-hidden="true" tabindex="-1"></a>    , <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">angle =</span> <span class="dv">90</span>)</span>
<span id="cb32-32"><a href="web-scraping-and-functions.html#cb32-32" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-33-1.png" width="768" /></p>
</div>
<div id="bonus-question-2" class="section level3 hasAnchor" number="4.2.8">
<h3><span class="header-section-number">4.2.8</span> Bonus Question 2<a href="web-scraping-and-functions.html#bonus-question-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Use a function and for loop to create yearly plots of precipitation by day of year. Color each site.</p>
<p><span style="color: blue;">Personally, I prefer using <code>facet_grid</code> to make small multiples instead of creating an independent graph for each year.</span></p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="web-scraping-and-functions.html#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="do">## summarize total precipitation by date, site</span></span>
<span id="cb33-2"><a href="web-scraping-and-functions.html#cb33-2" aria-hidden="true" tabindex="-1"></a>metoc_hourly_full <span class="sc">%&gt;%</span></span>
<span id="cb33-3"><a href="web-scraping-and-functions.html#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2004</span><span class="sc">:</span><span class="dv">2010</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb33-4"><a href="web-scraping-and-functions.html#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date_id =</span> <span class="fu">make_date</span>(year, month, day)</span>
<span id="cb33-5"><a href="web-scraping-and-functions.html#cb33-5" aria-hidden="true" tabindex="-1"></a>         , <span class="at">day_of_year =</span> <span class="fu">yday</span>(date_id)</span>
<span id="cb33-6"><a href="web-scraping-and-functions.html#cb33-6" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span> </span>
<span id="cb33-7"><a href="web-scraping-and-functions.html#cb33-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(site, day_of_year, year) <span class="sc">%&gt;%</span> </span>
<span id="cb33-8"><a href="web-scraping-and-functions.html#cb33-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">tot_precip =</span> <span class="fu">sum</span>(precip..kg.m.<span class="fl">2.</span>s.<span class="fl">1.</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb33-9"><a href="web-scraping-and-functions.html#cb33-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(site, year, day_of_year) <span class="sc">%&gt;%</span> </span>
<span id="cb33-10"><a href="web-scraping-and-functions.html#cb33-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month_day =</span> <span class="fu">as.Date</span>(day_of_year, <span class="at">origin =</span> <span class="st">&quot;1999-12-31&quot;</span>)) <span class="sc">%&gt;%</span> <span class="do">## this date will make for plotting with date label</span></span>
<span id="cb33-11"><a href="web-scraping-and-functions.html#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="do">## plot mean precip by doy</span></span>
<span id="cb33-12"><a href="web-scraping-and-functions.html#cb33-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(., <span class="fu">aes</span>(<span class="at">x =</span> month_day, <span class="at">y =</span> tot_precip, <span class="at">color =</span> site)) <span class="sc">+</span></span>
<span id="cb33-13"><a href="web-scraping-and-functions.html#cb33-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha=</span><span class="fl">0.5</span>, <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb33-14"><a href="web-scraping-and-functions.html#cb33-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> loess, <span class="at">span =</span> <span class="fl">0.2</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">alpha=</span><span class="dv">1</span>, <span class="at">size =</span> <span class="fl">0.9</span>) <span class="sc">+</span> </span>
<span id="cb33-15"><a href="web-scraping-and-functions.html#cb33-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(year <span class="sc">~</span> site, <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>) <span class="sc">+</span></span>
<span id="cb33-16"><a href="web-scraping-and-functions.html#cb33-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(<span class="at">date_labels =</span> <span class="st">&quot;%b-%d&quot;</span>, <span class="at">date_minor_breaks =</span> <span class="st">&quot;1 month&quot;</span>) <span class="sc">+</span></span>
<span id="cb33-17"><a href="web-scraping-and-functions.html#cb33-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb33-18"><a href="web-scraping-and-functions.html#cb33-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">&quot;Precipitation by Day of Year&quot;</span></span>
<span id="cb33-19"><a href="web-scraping-and-functions.html#cb33-19" aria-hidden="true" tabindex="-1"></a>      , <span class="at">subtitle =</span> <span class="st">&quot;Swamp Angel Study Plot and Senator Beck Study Plot&quot;</span></span>
<span id="cb33-20"><a href="web-scraping-and-functions.html#cb33-20" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb33-21"><a href="web-scraping-and-functions.html#cb33-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Tot. Precip. (kg/m2/s)&quot;</span>) <span class="sc">+</span></span>
<span id="cb33-22"><a href="web-scraping-and-functions.html#cb33-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb33-23"><a href="web-scraping-and-functions.html#cb33-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Dark2&quot;</span>) <span class="sc">+</span></span>
<span id="cb33-24"><a href="web-scraping-and-functions.html#cb33-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb33-25"><a href="web-scraping-and-functions.html#cb33-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb33-26"><a href="web-scraping-and-functions.html#cb33-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position=</span><span class="st">&quot;none&quot;</span></span>
<span id="cb33-27"><a href="web-scraping-and-functions.html#cb33-27" aria-hidden="true" tabindex="-1"></a>    , <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>)</span>
<span id="cb33-28"><a href="web-scraping-and-functions.html#cb33-28" aria-hidden="true" tabindex="-1"></a>    , <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>)</span>
<span id="cb33-29"><a href="web-scraping-and-functions.html#cb33-29" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-34-1.png" width="768" /></p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="wildfire-recovery.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="sp1.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
